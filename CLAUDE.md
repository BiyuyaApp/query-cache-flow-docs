# CLAUDE.md - Query Cache Flow Documentation Project

## Project Overview

This project builds documentation for **Query Cache Flow**, a TanStack Query cache key management framework. The documentation consists of:

1. **Landing Page** (`landing/index.html`) - A beautiful, single-file HTML page
2. **Docusaurus Site** (`docs/`) - Full developer documentation

## Key Commands

```bash
# Build landing page (just open in browser)
open landing/index.html

# Docusaurus commands (in docs/ directory)
cd docs && npm install
npm run start    # Dev server at localhost:3000
npm run build    # Production build
```

## What is Query Cache Flow?

Query Cache Flow is a pattern/framework for managing TanStack Query cache keys in React applications. The core philosophy:

**REST → OpenAPI → KUBB → Autogenerated wrappers with built-in invalidation → Zero-thought usage**

### Problem It Solves

1. Manual cache keys are error-prone and inconsistent
2. Cache invalidation is hard to get right
3. Generated hooks from KUBB need a wrapper layer for proper caching
4. Developers shouldn't think about cache keys at all

### Core Concepts

#### 1. QueryKey Type
```typescript
type QueryKey<T> = {
  entity: string;          // 'accounts', 'transactions'
  method?: string;         // 'list', 'detail', 'create', etc.
  id?: T;                  // For detail/update/remove
};
```

#### 2. QueryGroup Pattern
```typescript
interface QueryGroup<T> {
  queryKey: QueryKey<T>;
  invalidates?: QueryKey<T>;
  type?: 'query' | 'mutation';
  normalize?: (data: any) => void;  // Optimistic updates
}
```

#### 3. CRUD Factory
```typescript
const accountsQueryGroup = createQueryGroupCRUD<AccountId>('accounts');
// Creates: all, list, detail, create, update, remove
// Each with proper queryKey, invalidates, and normalize functions
```

#### 4. Key Injection
```typescript
accountsQueryGroup = inyectKeysToQueries(accountsQueryGroup, {
  auth: true,  // Add to ALL keys in the group
});
```

#### 5. Wrapper Hooks
```typescript
// Wrap KUBB-generated hook with proper cache key
export const useAccounts = () =>
  generatedUseAccounts({
    query: { queryKey: [accountsQueryGroup.list.queryKey] },
  });
```

## Directory Structure To Create

```
cache-flow-docs/
├── landing/
│   ├── index.html          # Single-file landing page
│   └── screenshots/        # Visual verification
├── docs/
│   ├── package.json
│   ├── docusaurus.config.js
│   ├── sidebars.js
│   ├── static/img/
│   ├── src/
│   │   ├── css/custom.css
│   │   └── pages/
│   └── docs/
│       ├── intro.md
│       ├── getting-started/
│       │   ├── installation.md
│       │   ├── quick-start.md
│       │   └── project-structure.md
│       ├── core-concepts/
│       │   ├── query-keys.md
│       │   ├── query-groups.md
│       │   ├── crud-factory.md
│       │   └── key-injection.md
│       ├── api-reference/
│       │   ├── createQueryGroupCRUD.md
│       │   ├── invalidateQueriesForKeys.md
│       │   ├── cancelQueriesForKeys.md
│       │   └── inyectKeysToQueries.md
│       ├── patterns/
│       │   ├── wrapper-hooks.md
│       │   ├── cascade-invalidation.md
│       │   ├── optimistic-updates.md
│       │   ├── pagination.md
│       │   └── entity-mapping.md
│       └── advanced/
│           ├── kubb-integration.md
│           ├── axios-interceptors.md
│           └── migration-guide.md
├── CLAUDE.md               # This file
├── README.md               # How to run the loop
└── .ralph-wiggum-prompt.md # Main loop prompt
```

## Design Guidelines

### Landing Page
- Modern, dark theme preferred
- Blue-to-purple gradient accents
- Syntax-highlighted code blocks
- Mobile responsive
- No external JS dependencies
- Inline critical CSS

### Documentation
- Matches landing page color scheme
- Clear navigation sidebar
- Copy-able code blocks
- Practical examples throughout
- Progressive complexity (intro → advanced)

## Dependencies Reference

The source project uses:
- `@tanstack/react-query` v5.90.16
- `@kubb/core`, `@kubb/plugin-react-query`, `@kubb/plugin-ts`, `@kubb/plugin-oas`
- `axios` for HTTP client
- TypeScript throughout

Documentation site uses:
- `@docusaurus/preset-classic`
- React 18+
- Node 18+

## Skills To Use

- `/ui-ux-pro-max` - For landing page and custom CSS design
- `/seo-optimizer` - For meta tags and SEO best practices
- `/playwright-skill` - For visual verification of pages

## Source Code Reference

The actual Query Cache Flow implementation lives in:
```
~/Documents/projects/biyuya-workspace/biyuya-frontend/
├── src/queries/index.ts       # Core cache infrastructure
├── src/queries/client.ts      # QueryClient setup
├── kubb.config.ts             # KUBB configuration
├── openapi.json               # API specification
└── src/features/*/queries/    # Feature query groups
```

Read these files for accurate code examples in documentation.

## Quality Checklist

Before marking complete:
- [ ] Landing page renders correctly (desktop + mobile)
- [ ] All code examples are accurate to source
- [ ] No placeholder text remaining
- [ ] Navigation is logical and complete
- [ ] SEO meta tags are present
- [ ] Docusaurus builds without errors
- [ ] Naive reviewer pass completed
